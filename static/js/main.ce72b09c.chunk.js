(this.webpackJsonpbetterdori=this.webpackJsonpbetterdori||[]).push([[0],Array(21).concat([function(e,t,n){e.exports=n.p+"static/media/cancel.f8a7f639.svg"},function(e,t,n){e.exports=n.p+"static/media/submit.4360bbde.svg"},function(e,t,n){e.exports=n.p+"static/media/settings.348c169b.svg"},function(e,t,n){e.exports=n.p+"static/media/hamburger.833119f1.svg"},function(e,t,n){e.exports=n.p+"static/media/delete.5075b33e.svg"},function(e,t,n){e.exports=n.p+"static/media/album.5f063155.svg"},function(e,t,n){e.exports=n.p+"static/media/export.2a28091b.svg"},function(e,t,n){e.exports=n.p+"static/media/import.f76106f8.svg"},function(e,t,n){e.exports=n.p+"static/media/select.c1d3a7c6.svg"},function(e,t,n){e.exports=n.p+"static/media/single.710e706e.svg"},function(e,t,n){e.exports=n.p+"static/media/slide-1.9c55945b.svg"},function(e,t,n){e.exports=n.p+"static/media/slide-2.e739354f.svg"},function(e,t,n){e.exports=n.p+"static/media/flick.7b4a2e40.svg"},function(e,t,n){e.exports=n.p+"static/media/timer.593d700f.svg"},function(e,t,n){e.exports=n.p+"static/media/player.07060722.svg"},function(e,t,n){e.exports=n.p+"static/media/pause.9cf9cdb6.svg"},function(e,t,n){e.exports=n.p+"static/media/play.aa3ead50.svg"},function(e,t,n){e.exports=n.p+"static/media/x05.535eb49c.svg"},function(e,t,n){e.exports=n.p+"static/media/x10.bedeac54.svg"},function(e,t,n){e.exports=n.p+"static/media/x15.b4cf543a.svg"},function(e,t,n){e.exports=n.p+"static/media/x20.f8430c66.svg"},function(e,t,n){e.exports=n.p+"static/media/follow.f06e8e66.svg"},function(e,t,n){e.exports=n.p+"static/media/bars.04bc19f8.svg"},function(e,t,n){e.exports=n.p+"static/media/d1.d440bb37.svg"},function(e,t,n){e.exports=n.p+"static/media/d2.70994b05.svg"},function(e,t,n){e.exports=n.p+"static/media/d3.bed3323c.svg"},function(e,t,n){e.exports=n.p+"static/media/d4.9e36ff58.svg"},function(e,t,n){e.exports=n.p+"static/media/d6.0d8fa81a.svg"},function(e,t,n){e.exports=n.p+"static/media/d8.c7296f0f.svg"},function(e,t,n){e.exports=n.p+"static/media/focus.b3b0efea.svg"},function(e,t,n){e.exports=n.p+"static/media/cross.53b51969.svg"},function(e,t,n){e.exports=n.p+"static/media/flick.190f0e5d.mp3"},function(e,t,n){e.exports=n.p+"static/media/tap.343a1b11.mp3"},,function(e,t,n){e.exports=n(65)},,,,,function(e,t,n){},,,,,function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(16),c=n.n(i),o=(n(60),n(1)),l=n(73),s=n(4),u=n.n(s),m=n(5),f=n(9),d=Object(l.a)({root:{position:"relative",display:"flex",flexDirection:"column",justifyContent:"flex-start",width:"2em"}});var b=function(e){var t=e.children,n=d();return r.a.createElement("div",{className:n.root},t)},v=n(3),h=n(10),p=n(11),g=n.n(p),E=Object(l.a)({root:{width:"2em",height:"2em",cursor:"pointer",userSelect:"none",position:"relative","&:after":{content:"''",position:"absolute",pointerEvents:"none",left:0,top:0,right:0,bottom:0,border:"0px solid black"},"&:hover:after":{borderWidth:5},display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},selected:{backgroundColor:"rgba(0, 0, 0, 0.06)"},icon:{pointerEvents:"none",height:"2em"},alt:{position:"absolute",left:"100%",top:"".concat(100/3,"%"),height:"".concat(100/3,"%"),width:"".concat(100/3,"%"),display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:"#000",color:"#FFF",fontFamily:"D-DIN",fontWeight:"normal",fontSize:"0.6em","& div":{marginBottom:0}}});var j=function(e){var t=e.selected,n=e.onClick,i=e.alt,c=e.icon,l=e.children,s=Object(h.a)(e,["selected","onClick","alt","icon","children"]),u=E(s),m=Object(a.useState)(!1),f=Object(o.a)(m,2),d=f[0],b=f[1];return Object(a.useEffect)((function(){var e=function(e){"Control"===e.key&&b(!0)},t=function(e){"Control"===e.key&&b(!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),function(){window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}}),[]),r.a.createElement("div",{className:g()(u.root,Object(v.a)({},u.selected,t)),onClick:n},c&&r.a.createElement("img",{src:c,alt:"",className:u.icon}),l,d&&i&&r.a.createElement("div",{className:u.alt},r.a.createElement("div",null,i)))},y=n(7),O=[{type:"System",cmd:"BPM",beat:0,bpm:120}],x=function(e){localStorage.setItem("score",JSON.stringify(e))},k=function(){var e=null,t=null,n=function(e,t){var n=[];return e.forEach((function(e,t){var a=t.bpm;n.push({type:"System",cmd:"BPM",beat:e,bpm:a})})),t.forEach((function(e,t){var a=t.lane,r=Object(h.a)(t,["lane"]);n.push(Object(y.a)({type:"Note",beat:e},r,{lane:a+1}))})),n.sort((function(e,t){return e.beat-t.beat})),n};return{submit:function(a,r){e=a,t=r,setTimeout((function(){e===a&&t===r&&(x(n(a,r)),console.log("Score saved!"))}),5e3)},save:function(){x(n(e,t))}}},w=n(74),C=n(20),S=n(21),F=n.n(S),N=n(22),M=n.n(N),T=function(){var e=Object(a.useState)(!1),t=Object(o.a)(e,2),n=t[0],r=t[1],i=Object(a.useState)(null),c=Object(o.a)(i,2),l=c[0],s=c[1],u=Object(a.useState)(null),m=Object(o.a)(u,2),f=m[0],d=m[1],b=Object(a.useCallback)((function(){return r(!0),new Promise((function(e,t){s((function(){return e})),d((function(){return t}))})).finally((function(){r(!1),s(null),d(null)}))}),[]);return Object(a.useMemo)((function(){return{opened:n,resolve:l,reject:f,open:b}}),[b,n,f,l])},D=Object(l.a)({overlay:{position:"fixed",left:0,top:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:5},sheetContainer:{position:"fixed",left:0,top:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:6,pointerEvents:"none"},sheet:{backgroundColor:"#FFF",padding:"1em",pointerEvents:"auto"},horizontal:{display:"flex",flexDirection:"row",justifyContent:"space-between",marginTop:-10,marginBottom:-10},cell:{marginTop:10,marginBottom:10,display:"block"},title:{fontWeight:"bold",fontSize:"".concat(40/60,"em"),lineHeight:"".concat(1.25,"em"),width:"".concat(12,"em")},input:{outline:"none",border:"none",backgroundColor:"#000",color:"#FFF",fontSize:"".concat(34/60,"em"),lineHeight:"".concat(50/34,"em"),height:"".concat(50/34,"em"),fontFamily:"D-DIN",fontWeight:"normal",paddingLeft:"".concat(10/34,"em"),width:"".concat(320/34,"em")},text:{fontSize:"".concat(32/60,"em"),lineHeight:"".concat(50/32,"em"),height:"".concat(50/32,"em"),fontWeight:"normal",paddingRight:"".concat(1.875,"em")},button:{width:"".concat(2,"em"),height:"".concat(50/60,"em"),backgroundColor:"rgba(0, 0, 0, 0.06)",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",cursor:"pointer",position:"relative","&:hover::after":{content:"''",position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.14)"},border:"none",outline:"none",fontSize:"inherit"},icon:{height:"100%"}}),R=Object(a.createContext)(null);function L(e){var t=e.dialog,n=e.children,i=D(),c=Object(a.useCallback)((function(){t.reject&&t.reject()}),[t]),o=Object(C.a)(),l=Object(a.useMemo)((function(){return Object(y.a)({},t,{form:o})}),[t,o]);return r.a.createElement("form",{onSubmit:o.handleSubmit(t.resolve)},r.a.createElement(R.Provider,{value:l},r.a.createElement(w.a,{in:t.opened,timeout:120,classNames:"fade",mountOnEnter:!0,unmountOnExit:!0},r.a.createElement("div",{className:i.overlay,onClick:c})),n))}function P(e){var t=e.children,n=D(),i=Object(a.useContext)(R).opened;return r.a.createElement(w.a,{in:i,timeout:120,classNames:"scale",mountOnEnter:!0,unmountOnExit:!0},r.a.createElement("div",{className:n.sheetContainer},r.a.createElement("div",{className:n.sheet},t)))}function Y(e){var t=e.children,n=D();return r.a.createElement("div",{className:n.horizontal},t)}function K(e){var t=e.el,n=void 0===t?"div":t,a=e.children,i=e.classes,c=e.innerRef,o=Object(h.a)(e,["el","children","classes","innerRef"]),l=D({classes:i});return r.a.createElement(n,Object.assign({className:l.cell,ref:c},o),a)}function W(e){var t=e.children,n=D();return r.a.createElement(K,{classes:{cell:n.title}},t)}function A(e){var t=e.classes,n=Object(h.a)(e,["classes"]),i=D({classes:t}),c=Object(a.useContext)(R).form.register;return r.a.createElement(K,Object.assign({el:"input",classes:{cell:i.input},innerRef:c},n))}function z(e){var t=e.children,n=D();return r.a.createElement(K,{classes:{cell:n.text}},t)}function B(e){var t=D(),n=Object(a.useContext)(R).reject;return r.a.createElement(K,Object.assign({classes:{cell:t.button},onClick:n},e),r.a.createElement("img",{className:t.icon,alt:"Cancel",src:F.a}))}function H(e){var t=D();return r.a.createElement(K,Object.assign({el:"button",type:"submit",classes:{cell:t.button}},e),r.a.createElement("img",{className:t.icon,alt:"Submit",src:M.a}))}var X=n(23),I=n.n(X),q=n(24),$=n.n(q),U=n(25),J=n.n(U),V=n(26),G=n.n(V),Z=n(27),_=n.n(Z),Q=n(28),ee=n.n(Q),te=Object(l.a)({root:{position:"relative",fontSize:40},bpm:{fontSize:"0.8em",lineHeight:1,color:"#000",fontFamily:"D-DIN",fontWeight:"normal"},url:{width:"".concat(560/34,"em"),marginRight:"".concat(80/34,"em")}});var ne=function(e){var t=e.setScore,n=e.musicURL,i=e.setMusicURL,c=te(),o=T(),l=Object(a.useCallback)(Object(f.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.open();case 3:t(Object(m.a)(O)),e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:case"end":return e.stop()}}),e,null,[[0,6]])}))),[o,t]),s=T(),d=Object(a.useCallback)(Object(f.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.open();case 3:t=e.sent,n=t.url,i(n),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])}))),[s,i]);return r.a.createElement("div",{className:c.root},r.a.createElement(b,null,r.a.createElement(j,{icon:$.a}),r.a.createElement(j,{icon:J.a,onClick:l}),r.a.createElement(L,{dialog:o},r.a.createElement(P,null,r.a.createElement(Y,null,r.a.createElement("div",null,r.a.createElement(W,null,"\u5220\u9664\u8c31\u9762"),r.a.createElement(z,null,"\u786e\u8ba4\u5220\u9664\u8c31\u9762\uff1f\u6b64\u64cd\u4f5c\u65e0\u6cd5\u6062\u590d\u3002")),r.a.createElement("div",null,r.a.createElement(B,null),r.a.createElement(H,null))))),r.a.createElement(j,{icon:G.a,onClick:d}),r.a.createElement(L,{dialog:s},r.a.createElement(P,null,r.a.createElement(Y,null,r.a.createElement("div",null,r.a.createElement(W,null,"\u97f3\u9891\u5730\u5740"),r.a.createElement(A,{name:"url",defaultValue:n,classes:{input:c.url}})),r.a.createElement("div",null,r.a.createElement(B,null),r.a.createElement(H,null))))),r.a.createElement(j,{icon:_.a}),r.a.createElement(j,{icon:ee.a}),r.a.createElement(j,{icon:I.a})))},ae=function(e,t,n){Object(a.useEffect)((function(){if(e){var a=function(e){n&&n(e)};return e.addEventListener(t,a),function(){return e.removeEventListener(t,a)}}}),[e,n,t])},re=Object(l.a)({root:{position:"relative"},container:{position:"absolute",left:"100%",top:0,backgroundColor:"rgba(0, 0, 0, 0.06)"}});var ie=function(e){var t=e.code,n=e.setCode,i=e.matchCode,c=e.children,o=e.index,l=Object(h.a)(e,["code","setCode","matchCode","children","index"]),s=re(),u=Object(a.useCallback)((function(){return n(i)}),[i,n]),m=t===i,f=a.Children.count(c),d=Math.min(f-1,o);return r.a.createElement("div",{className:s.root},r.a.createElement(j,Object.assign({onClick:u,selected:m},l)),m&&r.a.createElement("div",{className:s.container,style:{top:"".concat(-2*d,"em")}},r.a.createElement(b,null,c)))};var ce=function(e){var t=e.state,n=e.setState,i=e.states,c=e.icons,o=Object(h.a)(e,["state","setState","states","icons"]),l=i.indexOf(t),s=Object(a.useCallback)((function(){var e=i[(l+1)%i.length];n(e)}),[l,n,i]);return r.a.createElement(j,Object.assign({onClick:s,selected:!1,icon:c[l]},o))},oe=Object(l.a)({nonactive:{opacity:.35}});var le=function(e){var t=e.state,n=e.setState,i=e.icon,c=oe(),o=Object(a.useCallback)((function(){return n((function(e){return!e}))}),[n]);return r.a.createElement(j,{onClick:o,selected:!1,icon:i,classes:{icon:g()(Object(v.a)({},c.nonactive,!t))}})},se=n(29),ue=n.n(se),me=n(30),fe=n.n(me),de=n(31),be=n.n(de),ve=n(32),he=n.n(ve),pe=n(33),ge=n.n(pe),Ee=n(34),je=n.n(Ee),ye=n(35),Oe=n.n(ye),xe=n(36),ke=n.n(xe),we=n(37),Ce=n.n(we),Se=n(38),Fe=n.n(Se),Ne=n(39),Me=n.n(Ne),Te=n(40),De=n.n(Te),Re=n(41),Le=n.n(Re),Pe=n(42),Ye=n.n(Pe),Ke=n(43),We=n.n(Ke),Ae=n(44),ze=n.n(Ae),Be=n(45),He=n.n(Be),Xe=n(46),Ie=n.n(Xe),qe=n(47),$e=n.n(qe),Ue=n(48),Je=n.n(Ue),Ve=n(49),Ge=n.n(Ve),Ze=Object(l.a)({root:{position:"relative",fontSize:40},bpm:{fontSize:"0.8em",lineHeight:1,color:"#000",fontFamily:"D-DIN",fontWeight:"normal"}});var _e=function(e){var t=e.music,n=e.follow,i=e.setFollow,c=e.setDivision,l=e.code,s=e.setCode,m=e.currentBPM,d=e.setCurrentBPM,v=Ze(),h=Object(a.useState)(t.paused),p=Object(o.a)(h,2),g=p[0],E=p[1],y=Object(a.useCallback)((function(e){e?t.pause():t.play()}),[t]);Object(a.useEffect)((function(){var e=function(){return E(t.paused)};return t.addEventListener("play",e),t.addEventListener("pause",e),function(){t.removeEventListener("play",e),t.removeEventListener("pause",e)}}),[t]);var O=Object(a.useState)(t.playbackRate),x=Object(o.a)(O,2),k=x[0],w=x[1],C=Object(a.useCallback)((function(e){t.playbackRate=e}),[t]);Object(a.useEffect)((function(){var e=function(){return w(t.playbackRate)};return t.addEventListener("ratechange",e),function(){return t.removeEventListener("ratechange",e)}}));var S=Object(a.useCallback)((function(){return c(1)}),[c]),F=Object(a.useCallback)((function(){return c(2)}),[c]),N=Object(a.useCallback)((function(){return c(3)}),[c]),M=Object(a.useCallback)((function(){return c(4)}),[c]),D=Object(a.useCallback)((function(){return c(6)}),[c]),R=Object(a.useCallback)((function(){return c(8)}),[c]),K=T(),z=Object(a.useCallback)(Object(f.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,K.open();case 3:t=e.sent,n=t.bpm,d(n),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])}))),[K,d]);return r.a.createElement("div",{className:v.root},r.a.createElement(b,null,r.a.createElement(ie,{code:l,setCode:s,alt:"E",index:0,matchCode:"select",icon:ue.a}),r.a.createElement(ie,{code:l,setCode:s,alt:"F",index:2,matchCode:"placement/single",icon:fe.a}),r.a.createElement(ie,{code:l,setCode:s,alt:"S",index:3,matchCode:"placement/slide-a",icon:be.a}),r.a.createElement(ie,{code:l,setCode:s,alt:"D",index:4,matchCode:"placement/slide-b",icon:he.a}),r.a.createElement(ie,{code:l,setCode:s,alt:"W",index:5,matchCode:"modification/flick",icon:ge.a}),r.a.createElement(ie,{code:l,setCode:s,alt:"A",index:6,matchCode:"timer",icon:je.a},r.a.createElement(j,{onClick:z},r.a.createElement("div",{className:v.bpm},m))),r.a.createElement(L,{dialog:K},r.a.createElement(P,null,r.a.createElement(Y,null,r.a.createElement("div",null,r.a.createElement(W,null,"\u8282\u594f\u6570\u503c"),r.a.createElement(A,{name:"bpm",defaultValue:m})),r.a.createElement("div",null,r.a.createElement(B,null),r.a.createElement(H,null))))),r.a.createElement(ie,{code:l,setCode:s,index:7,matchCode:"bars",icon:We.a},r.a.createElement(j,{alt:"1",onClick:S,icon:ze.a}),r.a.createElement(j,{alt:"2",onClick:F,icon:He.a}),r.a.createElement(j,{alt:"3",onClick:N,icon:Ie.a}),r.a.createElement(j,{alt:"4",onClick:M,icon:$e.a}),r.a.createElement(j,{alt:"6",onClick:D,icon:Je.a}),r.a.createElement(j,{alt:"8",onClick:R,icon:Ge.a})),r.a.createElement(ie,{code:l,setCode:s,alt:"R",index:8,matchCode:"player",icon:Oe.a},r.a.createElement(ce,{state:g,setState:y,states:[!1,!0],icons:[ke.a,Ce.a]}),r.a.createElement(ce,{state:k,setState:C,states:[.5,1,1.5,2],icons:[Fe.a,Me.a,De.a,Le.a]}),r.a.createElement(le,{state:n,setState:i,icon:Ye.a}))))},Qe=function(){var e=Object(a.useState)("select"),t=Object(o.a)(e,2);return{code:t[0],setCode:t[1]}},et=function(e){var t=e.music.duration,n=e.time2Timers,r=e.scaleRef,i=Object(a.useState)(null),c=Object(o.a)(i,2),l=c[0],s=c[1],u=Object(a.useRef)(0),m=Object(a.useState)({x:0,width:100}),f=Object(o.a)(m,2),d=f[0],b=f[1];Object(a.useEffect)((function(){l&&b(l.getBoundingClientRect())}),[l]);var v=Object(a.useCallback)((function(e){var a=d.x,i=d.width,c=-u.current,o=r.current*t,l=e.clientY-c,s=e.clientX-a,m=Math.max((1-l/o)*t,0),f=n.le(m),b=f.key,v=f.value;return{top:l,left:s,time:m,beat:v.beat+(m-b)/60*v.bpm,lane:s/i*11-2.5,ratioTop:l/o}}),[t,d,r,n]),h=Object(a.useCallback)((function(e){var n=r.current*t,a=e-window.innerHeight;a<0?a=0:e>n&&(a=n-window.innerHeight),u.current=a}),[t,r]),p=Object(a.useCallback)((function(e){var n=e.time,a=e.lane;return{x:d.x+(a+2.5)/11*d.width,y:-u.current+r.current*t*(1-n/t)}}),[t,d,r]),g=Object(a.useRef)({clientX:0,clientY:0}),E=Object(a.useCallback)((function(e){g.current=e}),[]);return ae(l,"mousemove",E),{containerEl:l,setContainerEl:s,inflate:v,keepInView:h,deflate:p,scrollRef:u,rect:d,mouseRef:g}},tt=n(13),nt=n.n(tt),at=function(e){var t=Object(a.useState)(e),n=Object(o.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){i(e)}),[e]),[r,i]},rt={follow:!1,division:2,scale:600,bpm:120,progressOffset:180,scrollSpeed:.03,thumbScrollSpeed:.027,scaleSpeed:5e-4,minScale:50,maxScale:2e3};var it=function(e){var t=e.music,n=e.score,r=Object(a.useMemo)((function(){var e=nt()(),t=!0,a=!1,r=void 0;try{for(var i,c=n[Symbol.iterator]();!(t=(i=c.next()).done);t=!0){var o=i.value,l=o.type,s=o.cmd,u=o.beat,m=o.bpm;"System"===l&&"BPM"===s&&(e=e.insert(u,{bpm:m}))}}catch(f){a=!0,r=f}finally{try{t||null==c.return||c.return()}finally{if(a)throw r}}return e}),[n]),i=Object(a.useMemo)((function(){var e=nt()(),t=!0,a=!1,r=void 0;try{for(var i,c=n[Symbol.iterator]();!(t=(i=c.next()).done);t=!0){var o=i.value,l=o.type,s=o.beat,u=o.lane,m=Object(h.a)(o,["type","beat","lane"]);"Note"===l&&(e=e.insert(s,Object(y.a)({},m,{lane:u-1})))}}catch(f){a=!0,r=f}finally{try{t||null==c.return||c.return()}finally{if(a)throw r}}return e}),[n]),c=at(r),l=Object(o.a)(c,2),s=l[0],u=l[1],m=at(i),f=Object(o.a)(m,2),d=f[0],b=f[1];!function(e){var t=e.timers,n=e.notes,r=Object(a.useMemo)(k,[]),i=r.submit,c=r.save;Object(a.useEffect)((function(){return window.addEventListener("beforeunload",c),function(){return window.removeEventListener("beforeunload",c)}}),[c]),Object(a.useEffect)((function(){i(t,n)}),[n,i,t])}({timers:s,notes:d});var v=Object(a.useMemo)((function(){for(var e=[],n=0,a=s.begin,r=s.at(1);a.hasNext;a.next(),r.next()){var i=a.key,c=a.value.bpm,o=r.key,l=n,u=n+(o-i)/c*60;e.push({time1:l,time2:u,beat1:i,beat2:o,bpm:c}),n=u}var m=s.end,f=m.key,d=m.value.bpm;return e.push({time1:n,time2:t.duration,beat1:f,beat2:(t.duration-n)/60*d+f,bpm:d}),e}),[s,t]),p=Object(a.useMemo)((function(){var e=nt()(),t=!0,n=!1,a=void 0;try{for(var r,i=v[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){var c=r.value,o=c.time1,l=c.beat1,s=c.bpm;e=e.insert(o,{beat:l,bpm:s})}}catch(u){n=!0,a=u}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}return e=e.insert(v[v.length-1].time2,{beat:v[v.length-1].beat2})}),[v]),g=Object(a.useMemo)((function(){var e=nt()(),t=!0,n=!1,a=void 0;try{for(var r,i=function(){var t=r.value,n=t.beat1,a=t.beat2,i=t.time1,c=t.bpm;d.forEach((function(t,a){var r=(t-n)/c*60+i;e=e.insert(r,Object(y.a)({},a,{beat:t}))}),n,a)},c=v[Symbol.iterator]();!(t=(r=c.next()).done);t=!0)i()}catch(o){n=!0,a=o}finally{try{t||null==c.return||c.return()}finally{if(n)throw a}}return e}),[v,d]),E=Object(a.useState)(rt.division),j=Object(o.a)(E,2),O=j[0],x=j[1],w=Object(a.useState)(rt.follow),C=Object(o.a)(w,2),S=C[0],F=C[1],N=Object(a.useRef)(rt.scale),M=Object(a.useCallback)((function(e){var t=p.le(e),n=t.key,a=t.value,r=a.bpm,i=a.beat,c=p.gt(e).value.beat,o=i+Math.round((e-n)/60*r*O)/O;o>c&&(o=c);var l=n+(o-i)/r*60;return{beat:o,time:l,bpm:r,delta:Math.abs(l-e)/60*r*O}}),[O,p]),T=Object(a.useCallback)((function(e){var t=g.le(e),n=t.valid,a=t.index;return n?a+1:0}),[g]),D=Object(a.useCallback)((function(e,t,n){for(var a=e.ge(t);a.valid&&a.key===t;a.next())if(a.value.lane===n)return a;return null}),[]),R=Object(a.useCallback)((function(e,t){return D(d,e,t)}),[D,d]),L=Object(a.useCallback)((function(e,t){g.forEach((function(n,a){if(t){for(var r in t)if(t[r]!==a[r])return;e(n,a)}}))}),[g]),P=Object(a.useCallback)((function(e){for(var t=g.begin;t.valid;){var n=t.key,a=[];do{a.push(t.value),t.next()}while(t.key<=n&&t.valid);e(n,a)}}),[g]),Y=Object(a.useCallback)((function(e,t,n,a,r){var i,c=t.le(n),o=c.key,l=c.value,s=l.beat,u=l.bpm,m=s+(n-o)/60*u,f=r*r,d=NaN;return e.forEach((function(e,t){var n=t.lane,r=Math.pow((n-a)/8,2)+Math.pow(e-m,2);r<f&&(f=r,i=e,d=n)}),m-r,m+r),isNaN(d)?null:{beat:i,lane:d,time:o+(i-s)/u*60}}),[]),K=Object(a.useCallback)((function(e,t,n){return Y(d,p,e,t,n)}),[Y,d,p]),W=Object(a.useState)(rt.bpm),A=Object(o.a)(W,2),z=A[0],B=A[1],H=Object(a.useMemo)((function(){var e=[];return["A","B"].forEach((function(t){var n=0,a=-1;L((function(t,r){var i=r.lane,c=r.end;if(-1!==a){var o=t;e.push({x0:a,x1:i,y0:n,y1:o})}a=c?-1:i,n=t}),{pos:t,note:"Slide"})})),e}),[L]),X=Object(a.useMemo)((function(){var e=[];return P((function(t,n){var a=8,r=-1,i=!0,c=!1,o=void 0;try{for(var l,s=n[Symbol.iterator]();!(i=(l=s.next()).done);i=!0){var u=l.value,m=u.lane,f=u.note,d=u.start,b=u.end;("Slide"!==f||d||b)&&(a=Math.min(a,m),r=Math.max(r,m))}}catch(v){c=!0,o=v}finally{try{i||null==s.return||s.return()}finally{if(c)throw o}}a<r-1&&e.push({time:t,minLane:a,maxLane:r})})),e}),[P]),I=Object(a.useMemo)((function(){var e=[],t=!0,n=!1,a=void 0;try{for(var r,i=v[Symbol.iterator]();!(t=(r=i.next()).done);t=!0)for(var c=r.value,o=c.beat1,l=c.beat2,s=c.bpm,u=c.time1,m=o;m<l;m+=1/O){var f=m-o,d=u+f/s*60,b=Math.abs(Math.round(f)-f)<1e-5;e.push({time:d,major:b})}}catch(h){n=!0,a=h}finally{try{t||null==i.return||i.return()}finally{if(n)throw a}}return e}),[v,O]);return Object(y.a)({music:t,timers:s,setTimers:u,notes:d,setNotes:b,ranges:v,time2Timers:p,time2Notes:g},rt,{division:O,setDivision:x,follow:S,setFollow:F,scaleRef:N,currentBPM:z,setCurrentBPM:B,quantize:M,countNotes:T,findNotePure:D,findNote:R,forEachNote:L,forEachGroup:P,matchNotePure:Y,matchNote:K,tapLines:X,bars:I,snakes:H})},ct=function(e){Object(a.useEffect)((function(){var t=!0;return requestAnimationFrame((function n(){e&&e(),t&&requestAnimationFrame(n)})),function(){t=!1}}),[e])},ot=Object(l.a)({root:{position:"relative",width:"11em",fontSize:"".concat(470/11,"px"),height:"100%",backgroundColor:"#000000",overflow:"hidden",willChange:"scroll-position"},canvas:{position:"fixed",left:"25vw",top:0}});var lt=function(e){var t=e.scaleRef,n=e.setContainerEl,i=e.scrollRef,c=e.music.duration,l=e.inflate,s=e.mouseRef,u=ot(),m=Object(a.useCallback)((function(e){e.preventDefault(),e.stopPropagation()}),[]),f=Object(a.useState)(null),d=Object(o.a)(f,2),b=d[0],v=d[1],h=Object(a.useMemo)((function(){return b?b.getContext("2d"):null}),[b]);return Object(a.useEffect)((function(){b&&(b.width=470,b.height=window.innerHeight)}),[b]),ct((function(){if(h&&b){var n=b.width,a=b.height,r=c-i.current/t.current,o=Math.max(0,r-a/t.current);h.fillStyle="#000",h.fillRect(0,0,n,a),function(e){var t=e.code,n=e.music,a=n.duration,r=n.currentTime,i=n.paused,c=e.scaleRef.current,o=e.progressOffset,l=e.keepInView,s=e.follow;"player"===t&&s&&!i&&l((a-r)*c+o)}(e);var u={ctx:h,startTime:o,endTime:r,mouse:l(s.current)};!function(e,t){for(var n=e.rect.width,a=e.scale,r=e.music.duration,i=t.ctx,c=n/11,o=0;o<=7;++o){var l=0===o||7===o;i.lineWidth=l?5:1,i.strokeStyle="rgba(255, 255, 255, 0.5)",i.beginPath(),i.moveTo(c*(o+2),0),i.lineTo(c*(o+2),a*r),i.stroke()}}(e,u),function(e,t){var n=e.scrollRef.current,a=e.music.duration,r=e.scaleRef.current,i=e.bars,c=e.rect.width,o=t.ctx,l=t.startTime,s=t.endTime,u=!0,m=!1,f=void 0;try{for(var d,b=i[Symbol.iterator]();!(u=(d=b.next()).done);u=!0){var v=d.value,h=v.time,p=v.major,g=c/11,E=g/r/2;if(!(h<l-E||h>s+E)){var j=(a-h)*r-n;o.lineWidth=1,o.strokeStyle=p?"rgba(255, 255, 255, 0.5)":"rgba(255, 255, 255, 0.3)",o.beginPath(),o.setLineDash(p?[]:[2,2]),o.moveTo(2*g,j),o.lineTo(9*g,j),o.stroke(),o.setLineDash([])}}}catch(y){m=!0,f=y}finally{try{u||null==b.return||b.return()}finally{if(m)throw f}}}(e,u),function(e,t){var n=e.time2Timers,a=e.scrollRef.current,r=e.music.duration,i=e.scaleRef.current,c=e.rect.width,o=t.ctx,l=t.startTime,s=t.endTime,u=c/11,m=u/i/2;o.fillStyle="#FFCD18",o.textAlign="start",o.font="".concat(.6*u,"px D-Din");var f=Math.max(r-(a+window.innerHeight)/i,0),d=n.gt(f),b=d.key;if(d.valid&&b-f>=1.25*u/i){var v=n.le(f).value.bpm;o.fillText("".concat(v),9.15*u,window.innerHeight-.36*u),o.beginPath();var h=9.55*u,p=window.innerHeight-.14*u;o.moveTo(h-5,p-3),o.lineTo(h+5,p-3),o.lineTo(h,p+2),o.closePath(),o.fill()}o.strokeStyle="#FFCD18",o.lineWidth=3,n.forEach((function(e,t){var n=t.bpm;if(!(e<l-m||e>s+m)){var c=(r-e)*i-a;o.beginPath(),o.moveTo(2*u,c),o.lineTo(9*u,c),o.stroke(),o.fillText("".concat(n),9.15*u,c+.2*u)}}))}(e,u),function(e,t){var n=e.rect.width,a=e.scrollRef.current,r=e.music.duration,i=e.scaleRef.current,c=e.tapLines,o=t.ctx,l=t.startTime,s=t.endTime,u=!0,m=!1,f=void 0;try{for(var d,b=c[Symbol.iterator]();!(u=(d=b.next()).done);u=!0){var v=d.value,h=v.time,p=v.minLane,g=v.maxLane,E=n/11,j=E/i/2;if(!(h<l-j||h>s+j)){var y=(r-h)*i-a;o.lineWidth=3,o.strokeStyle="#FFF",o.beginPath(),o.moveTo((p+2.5)*E,y),o.lineTo((g+2.5)*E,y),o.stroke()}}}catch(O){m=!0,f=O}finally{try{u||null==b.return||b.return()}finally{if(m)throw f}}}(e,u),function(e,t){var n=e.rect.width,a=e.scrollRef.current,r=e.music.duration,i=e.scaleRef.current,c=e.snakes,o=t.ctx,l=t.startTime,s=t.endTime,u=!0,m=!1,f=void 0;try{for(var d,b=c[Symbol.iterator]();!(u=(d=b.next()).done);u=!0){var v=d.value,h=v.x0,p=v.x1,g=v.y0,E=v.y1,j=n/11;if(!(E<l||g>s)){var y=(h+2.5)*j,O=(p+2.5)*j,x=(r-g)*i-a,k=(r-E)*i-a;o.fillStyle="rgba(122, 222, 174, 0.4)",o.beginPath(),o.moveTo(y-j/2,x),o.lineTo(y+j/2,x),o.lineTo(O+j/2,k),o.lineTo(O-j/2,k),o.closePath(),o.fill()}}}catch(w){m=!0,f=w}finally{try{u||null==b.return||b.return()}finally{if(m)throw f}}}(e,u),function(e,t){var n=e.music,a=n.duration,r=n.currentTime,i=e.scaleRef.current,c=e.code,o=e.scrollRef.current,l=e.rect.width,s=t.ctx;if("player"===c){var u=(a-r)*i-o;s.lineWidth=3,s.strokeStyle="#FF4E67",s.beginPath(),s.moveTo(0,u),s.lineTo(l,u),s.stroke()}}(e,u),function(e,t){var n=e.quantize,a=e.rect.width,r=e.music.duration,i=e.scaleRef.current,c=e.scrollRef.current,o=e.code,l=t.ctx,s=t.mouse.time;if(o.startsWith("placement/")||o.startsWith("modification/")||"timer"===o){var u=n(s),m=u.time,f=u.beat,d=a/11,b=(r-m)*i-c;l.lineWidth=3,l.strokeStyle="#5996FF",l.beginPath(),l.moveTo(2*d,b),l.lineTo(9*d,b),l.stroke(),l.fillStyle="#5996FF",l.font="".concat(.6*d,"px D-Din"),l.textAlign="end",l.fillText("".concat(f.toFixed(2),"'"),2*d-.15*d,b+.3*d)}}(e,u),function(e,t){var n=e.rect.width,a=e.scrollRef.current,r=e.scaleRef.current,i=e.music.duration,c=e.code,o=e.countNotes,l=t.ctx,s=t.mouse.time;if("player"===c){var u=n/11,m=(i-s)*r-a;l.lineWidth=3,l.strokeStyle="#5996FF",l.beginPath(),l.moveTo(2*u,m),l.lineTo(9*u,m),l.stroke(),l.fillStyle="#5996FF",l.font="".concat(.6*u,"px D-Din"),l.textAlign="end",l.fillText("".concat(o(s)),1.85*u,m+.3*u)}}(e,u),function(e,t){var n=e.rect.width,a=e.scrollRef.current,r=e.music.duration,i=e.scaleRef.current,c=e.code,o=e.time2Notes,l=t.ctx,s=t.startTime,u=t.endTime;o.forEach((function(e,t){var o=t.lane,m=t.note,f=t.flick,d=t.start,b=t.end,v=t.thumb,h=t.selected,p=n/11,g=p/i/2;if(!(e<s-g||e>u+g)){var E=(o+2.5)*p,j=(r-e)*i-a,y="Single"===m,O="Slide"===m,x=d||b,k=(!v&&(c.startsWith("placement/")||c.startsWith("modification/")),O&&!x),w="select"===c;if(y&&!f&&(l.fillStyle="#FFF",l.beginPath(),l.arc(E,j,p/2,0,2*Math.PI),l.fill()),O&&x&&!f&&(l.fillStyle="#7ADEAE",l.beginPath(),l.arc(E,j,p/2,0,2*Math.PI),l.fill()),f&&(l.fillStyle="#FFA0E8",l.beginPath(),l.arc(E,j,p/2,0,2*Math.PI),l.fill()),!k||w&&h||(l.lineWidth=3,l.strokeStyle="#7ADEAE",l.beginPath(),l.moveTo(E-p/2,j),l.lineTo(E+p/2,j),l.stroke()),k&&h&&w&&(l.lineWidth=3,l.strokeStyle="#5996FF",l.beginPath(),l.moveTo(E-p/2,j),l.lineTo(E+p/2,j),l.stroke()),h&&w&&!k){var C=p/60*7;l.lineWidth=3,l.strokeStyle="#5996FF",l.beginPath(),l.moveTo(E-C,j-C),l.lineTo(E+C,j+C),l.moveTo(E+C,j-C),l.lineTo(E-C,j+C),l.stroke()}}}))}(e,u)}})),r.a.createElement("div",{ref:n,className:u.root,onContextMenu:m},r.a.createElement("canvas",{className:u.canvas,ref:v}))},st=Object(l.a)({root:{position:"absolute",height:"100%",width:"".concat(7/11*100,"%"),left:"".concat(2/11*100,"%"),opacity:.5,"&$thumb":{opacity:.3}},lanes:{position:"absolute",left:0,top:0,width:"100%",height:"100%",display:"flex",flexDirection:"row",justifyContent:"space-between"},sideLane:{width:0,borderRight:"5px solid #FFF",marginRight:-2,marginLeft:-2},middleLane:{width:0,borderRight:"1px solid #FFF"},bar:{position:"absolute",left:0,width:"100%",borderBottom:"1px dashed rgba(255, 255, 255, 0.6)"},major:{borderBottom:"1px solid #FFF"},thumb:{}});var ut=function(e){var t=e.music.duration,n=e.ranges,i=e.division,c=e.thumb,o=void 0!==c&&c,l=st(),s=Object(a.useMemo)((function(){var e=[],a=!0,c=!1,o=void 0;try{for(var s,u=n[Symbol.iterator]();!(a=(s=u.next()).done);a=!0)for(var m=s.value,f=m.beat1,d=m.beat2,b=m.bpm,h=m.time1,p=f;p<d;p+=1/i){var E=p-f,j=h+E/b*60,y=Math.abs(Math.round(E)-E)<1e-5;e.push(r.a.createElement("div",{key:j,className:g()(l.bar,Object(v.a)({},l.major,y)),style:{bottom:"".concat(j/t*100,"%")}}))}}catch(O){c=!0,o=O}finally{try{a||null==u.return||u.return()}finally{if(c)throw o}}return e}),[n,t,i,l]);return r.a.createElement("div",{className:g()(l.root,Object(v.a)({},l.thumb,o))},r.a.createElement("div",{className:l.lanes},r.a.createElement("div",{className:o?l.middleLane:l.sideLane}),r.a.createElement("div",{className:l.middleLane}),r.a.createElement("div",{className:l.middleLane}),r.a.createElement("div",{className:l.middleLane}),r.a.createElement("div",{className:l.middleLane}),r.a.createElement("div",{className:l.middleLane}),r.a.createElement("div",{className:l.middleLane}),r.a.createElement("div",{className:o?l.middleLane:l.sideLane})),s)},mt=n(50),ft=n.n(mt),dt=n(51),bt=n.n(dt),vt=Object(l.a)({root:{position:"absolute",height:"100%",width:"".concat(7/11*100,"%"),left:"".concat(2/11*100,"%")},note:{width:"1em",height:"1em",borderRadius:"50%",position:"absolute",marginBottom:"-0.5em","&$focusable:hover $focus":{visibility:"initial"},"&$thumb":{transform:"scale(0.5)"},boxSizing:"border-box","&$selected":{border:"4px solid #5996FF"},"&$middle":{border:"none"}},focusable:{cursor:"pointer"},focus:{position:"absolute",width:"1.4em",height:"1.4em",left:"-0.2em",top:"-0.2em",pointerEvents:"none",visibility:"hidden",userSelect:"none"},single:{backgroundColor:"#FFF"},slide:{backgroundColor:"#7ADEAE"},flick:{backgroundColor:"#FFA0E8","&:after":{content:"''",position:"absolute",left:"50%",top:"50%",width:0,height:0,borderLeft:"".concat(10/60,"em solid transparent"),borderRight:"".concat(10/60,"em solid transparent"),borderBottom:"".concat(16.739/60,"em solid #FFF"),borderTop:"none",marginLeft:"-".concat(10/60,"em"),marginTop:"-".concat(16.739/60/2,"em")},"&$thumb:after":{visibility:"hidden"}},middle:{"&:after":{content:"''",position:"absolute",left:0,right:0,bottom:"50%",borderBottom:"3px solid #7ADEAE",marginBottom:-1.5},"&$middleSelected:after":{borderBottom:"3px solid #5996FF"},"&$thumb:after":{opacity:.6}},tapLine:{position:"absolute",marginLeft:"1em",marginRight:0,height:0,marginBottom:-1.5,borderBottom:"3px solid #FFF"},snake:{position:"absolute",left:0,right:0,display:"flex"},thumb:{},selected:{position:"absolute",height:"100%",left:0,top:0,pointerEvents:"none",userSelect:"none",zIndex:2},middleSelected:{}});function ht(e){var t,n=e.time,a=e.duration,i=e.lane,c=e.note,o=e.flick,l=e.start,s=e.end,u=e.code,m=e.thumb,f=e.selected,d=vt(),b="Single"===c,h="Slide"===c,p=l||s,E=!m&&(u.startsWith("placement/")||u.startsWith("modification/")||"select"===u),j=h&&!p,y="select"===u;return r.a.createElement("div",{className:g()(d.note,(t={},Object(v.a)(t,d.single,b&&!o),Object(v.a)(t,d.slide,h&&p&&!o),Object(v.a)(t,d.flick,o),Object(v.a)(t,d.middle,j),Object(v.a)(t,d.focusable,E),Object(v.a)(t,d.thumb,m),Object(v.a)(t,d.middleSelected,j&&f&&y),t)),style:{bottom:"".concat(n/a*100,"%"),left:"".concat(i/7*100,"%")}},r.a.createElement("img",{className:d.focus,alt:"focus",src:ft.a}),!m&&f&&!j&&y&&r.a.createElement("img",{className:d.selected,alt:"selected",src:bt.a}))}function pt(e){var t=e.x0,n=e.x1,a=e.y0,i=e.y1,c=(e.thumb,vt());return r.a.createElement("div",{className:c.snake,style:{bottom:"".concat(100*a,"%"),top:"".concat(100*(1-i),"%")}},r.a.createElement("svg",{width:"100%",height:"100%",viewBox:"0 0 7 1",preserveAspectRatio:"none"},r.a.createElement("polygon",{fill:"rgba(122, 222, 174, 0.4)",strokeWidth:"0",points:"".concat(t,",1 ").concat(t+1,",1 ").concat(n+1,",0 ").concat(n,",0")})))}var gt=function(e){var t=e.time2Notes,n=e.music.duration,i=e.notes,c=e.setNotes,o=e.findNote,l=e.forEachNote,s=e.forEachGroup,u=e.code,f=e.thumb,d=void 0!==f&&f,b=vt(),v=Object(a.useMemo)((function(){var e=[];return d||["A","B"].forEach((function(t){var a=0,i=-1;l((function(c,o){var l=o.lane,s=o.end;if(-1!==i){var u=c/n;e.push(r.a.createElement(pt,{key:"snake-".concat(a,"-").concat(u,"-").concat(t),x0:i,x1:l,y0:a,y1:u}))}i=s?-1:l,a=c/n}),{pos:t,note:"Slide"})})),e}),[n,l,d]),h=Object(a.useMemo)((function(){var e=[];return d||s((function(t,a){var i=8,c=-1,o=!0,l=!1,s=void 0;try{for(var u,m=a[Symbol.iterator]();!(o=(u=m.next()).done);o=!0){var f=u.value,d=f.lane,v=f.note,h=f.start,p=f.end;("Slide"!==v||h||p)&&(i=Math.min(i,d),c=Math.max(c,d))}}catch(g){l=!0,s=g}finally{try{o||null==m.return||m.return()}finally{if(l)throw s}}i<c-1&&e.push(r.a.createElement("div",{key:"tap-line-".concat(t),className:b.tapLine,style:{bottom:"".concat(t/n*100,"%"),left:"".concat(i/7*100,"%"),right:"".concat((7-c)/7*100,"%")}}))})),e}),[b,n,s,d]),p=Object(a.useMemo)((function(){var e=[];return t.forEach((function(t,a){e.push(r.a.createElement(ht,Object.assign({key:"note-".concat(a.beat,"-").concat(a.lane),time:t,duration:n,notes:i,setNotes:c,findNote:o,code:u,thumb:d},a)))})),e}),[u,n,o,i,c,t,d]),g=Object(a.useMemo)((function(){return[].concat(Object(m.a)(v),Object(m.a)(h),Object(m.a)(p))}),[v,h,p]);return r.a.createElement("div",{className:b.root},g)},Et=function(e){var t=e.onDragStart,n=e.onDrag,r=e.onDragEnd,i=e.el,c=Object(a.useMemo)((function(){return{left:!1,right:!1,dragging:!1,shift:!1,lestX:0,lastY:0,startX:0,startY:0}}),[]),o=Object(a.useCallback)((function(e){if((0===e.button&&(c.left=!0),2===e.button&&(c.right=!0),c.shift=e.shiftKey,c.lastX=e.clientX,c.lastY=e.clientY,c.startX=e.clientX,c.startY=e.clientY,!c.dragging)&&(c.dragging=!0,t&&!1===t(e,c)))return void(c.left=c.right=c.dragging=!1);e.preventDefault(),e.stopPropagation()}),[t,c]),l=Object(a.useCallback)((function(e){if(c.shift=e.shiftKey,c.dragging){var t=Math.round(Math.abs(e.clientY-c.lastY)/15);0===t&&(t=1);for(var a=1;a<=t;++a){var r=a/t,i=c.lastX+(e.clientX-c.lastX)*r,o=c.lastY+(e.clientY-c.lastY)*r;n&&n({clientX:i,clientY:o},c)}c.lastX=e.clientX,c.lastY=e.clientY}e.preventDefault(),e.stopPropagation()}),[n,c]),s=Object(a.useCallback)((function(e){c.dragging&&(r&&r(e,c),c.dragging=!1),0===e.button&&(c.left=!1),2===e.button&&(c.right=!1),e.preventDefault(),e.stopPropagation()}),[r,c]);Object(a.useEffect)((function(){if(i)return i.addEventListener("mousedown",o),i.addEventListener("mousemove",l),i.addEventListener("mouseup",s),function(){i.removeEventListener("mousedown",o),i.removeEventListener("mousemove",l),i.removeEventListener("mouseup",s)}}),[i,o,l,s])};function jt(e){var t=0,n=0,a=0,r=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(t=n,n=0),a=10*t,r=10*n,"deltaY"in e&&(r=e.deltaY),"deltaX"in e&&(a=e.deltaX),(a||r)&&e.deltaMode&&(1===e.deltaMode?(a*=40,r*=40):(a*=800,r*=800)),a&&!t&&(t=a<1?-1:1),r&&!n&&(n=r<1?-1:1),{spinX:t,spinY:n,pixelX:a,pixelY:r}}var yt=Object(l.a)({root:{position:"relative",backgroundColor:"#000000",width:"11em",fontSize:"".concat(78/11,"px"),right:0,top:0,height:"100%",overflow:"hidden"}});var Ot=function(e){var t=e.children,n=e.scaleRef,i=e.music.duration,c=e.containerEl,l=e.thumbScrollSpeed,s=e.scrollRef,u=yt(),m=Object(a.useState)(null),f=Object(o.a)(m,2),d=f[0],b=f[1],v=Object(a.useCallback)((function(e,t){var a=t.left;if(c&&a){var r=n.current,o=e.clientY/window.innerHeight*i,l=window.innerHeight/r,u=i*r,m=(o-l/2)/i*u;m<0&&(m=0),m+window.innerHeight>u&&(m=u-window.innerHeight),s.current=m}}),[c,i,n,s]);Et({onDrag:v,onDragEnd:v,el:d});var h=Object(a.useCallback)((function(e){if(c){var t=jt(e.nativeEvent).pixelY,a=n.current,r=i*a,o=s.current/r*window.innerHeight,u=window.innerHeight/a,m=o+t*l;m<0&&(m=0),m+u>window.innerHeight&&(m=window.innerHeight-u);var f=m/window.innerHeight*r;s.current=f}}),[c,i,n,s,l]);return r.a.createElement("div",{className:u.root,ref:b,onWheel:h},t)};Object(l.a)({stencil:{position:"absolute",left:0,top:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.65)",pointerEvents:"none",willChange:"transform"}});var xt=Object(l.a)({root:{position:"absolute",height:"100%",left:"".concat(2/11*100,"%"),right:"".concat(2/11*100,"%")},timer:{position:"absolute",left:0,right:0,height:0,borderBottom:"1px solid #FFCD18",marginBottom:-.5}});function kt(e){var t=e.time,n=e.duration,a=xt();return r.a.createElement("div",{className:a.timer,style:{bottom:"".concat(t/n*100,"%")}})}var wt=function(e){var t=e.time2Timers,n=e.music.duration,i=xt(),c=Object(a.useMemo)((function(){var e=[];return t.forEach((function(t,a){var i=a.beat;e.push(r.a.createElement(kt,{key:i,time:t,duration:n}))})),e}),[t,n]);return r.a.createElement("div",{className:i.root},c)},Ct=n(6),St=n.n(Ct);var Ft=function(e){var t=e.music,n=e.code,i=e.setCode,c=Object(a.useCallback)((function(e,n){t.paused?t.play():t.pause(),n.stopPropagation(),n.preventDefault()}),[t]),o=Object(a.useCallback)((function(){return i("player")}),[i]);return Object(a.useEffect)((function(){"player"!==n&&t.pause()}),[n,t]),r.a.createElement(r.a.Fragment,null,r.a.createElement(St.a,{handleKeys:["r"],onKeyEvent:o}),r.a.createElement(St.a,{isDisabled:"player"!==n,handleKeys:["space"],onKeyEvent:c}))},Nt=n(17),Mt=n(52),Tt=n.n(Mt),Dt=n(53),Rt=n.n(Dt);var Lt=function(e){var t=e.music,n=e.time2Notes,i=Object(a.useMemo)((function(){return new Nt.Howl({src:[Rt.a]})}),[]),c=Object(a.useMemo)((function(){return new Nt.Howl({src:[Tt.a]})}),[]),o=Object(a.useRef)(0),l=Object(a.useCallback)((function(){if(!t.paused){var e=!1,a=!1;n.forEach((function(t,n){n.flick?a=!0:e=!0}),o.current,t.currentTime),o.current=t.currentTime,e&&i.play(),a&&c.play()}}),[c,t,i,n]);return ct(l),r.a.createElement("div",null)};var Pt=function(e){var t=e.music,n=e.containerEl,r=e.code,i=e.inflate,c=Object(a.useCallback)((function(e){if("player"===r){var n=i(e).time;t.currentTime=n,t.paused&&t.play()}}),[r,i,t]);return ae(n,"click",c),null},Yt=function(e,t){var n=e.notes,r=e.setNotes,i=e.inflate,c=e.code,o=e.findNotePure,l=e.matchNotePure,s=e.time2Timers,u=e.quantize,m=e.containerEl,f=t.prefix,d=t.useRemove,b=void 0===d||d,v=t.type,h=t.onClick,p=t.quantizeThreshold,g=void 0===p?.25:p,E=t.snapThreshold,j=void 0===E?.1:E,y=Object(a.useRef)(n);Object(a.useEffect)((function(){y.current=n}),[n]);var O=Object(a.useRef)(c);Object(a.useEffect)((function(){O.current=c}),[c]);var x=Object(a.useCallback)((function(){if(!c.startsWith(f))return!1}),[c,f]),k=Object(a.useCallback)((function(e,t){var n=t.shift,a=t.left,m=t.right,f=y.current,d=function(e){r(e),y.current=e};if(n){if(a)switch(v){case"quantize":var p=i(e),E=p.time,O=p.lane,x=u(E),k=x.beat;if(x.delta>g)return;var w=Math.round(O);if(w<0||w>=7)return;h(c,f,o,d,k,w,!1);break;case"snap":var C=i(e),S=C.time,F=C.lane,N=l(f,s,S,F,j);if(!N)return;var M=N.beat,T=N.lane;h(c,f,o,d,M,T,!1)}if(b&&m){var D=i(e),R=D.time,L=D.lane,P=l(f,s,R,L,j);if(!P)return;var Y=P.beat,K=P.lane,W=o(f,Y,K);W&&d(W.remove())}}}),[c,s,o,u,i,r,l,v,b,h,g,j]),w=Object(a.useCallback)((function(e,t){var n=t.shift,a=t.left,m=t.right,f=y.current;if(!n){var d=i(e),p=d.time,E=d.lane;if(a)switch(v){case"quantize":var O=i(e),x=O.time,k=O.lane,w=u(x),C=w.beat;if(w.delta>g)return;var S=Math.round(k);if(S<0||S>=7)return;h(c,f,o,r,C,S,!0);break;case"snap":var F=i(e),N=F.time,M=F.lane,T=l(f,s,N,M,j);if(!T)return;var D=T.beat,R=T.lane;h(c,f,o,r,D,R,!0)}if(b&&m){var L=l(f,s,p,E,j);if(!L)return;var P=L.beat,Y=L.lane,K=o(f,P,Y);K&&r(K.remove())}}}),[c,s,o,i,l,u,r,v,b,h,g,j]);Et({onDragStart:x,onDrag:k,onDragEnd:w,el:m})},Kt=function(e,t,n,a,r,i,c){switch(e){case"placement/single":if(n(t,r,i))break;a(t.insert(r,{note:"Single",lane:i}));break;case"placement/slide-a":case"placement/slide-b":var o=e.substring(e.length-1).toUpperCase(),l=n(t,r,i);if(l){if(c){var s=l.value,u=s.note,m=s.pos,f=s.end,d=s.start;if("Slide"!==u||m!==o)break;a(l.update({lane:i,pos:o,note:"Slide",flick:!1,start:!1,end:!(f||d)}))}}else{for(var b=!0,v=t.lt(r);v.valid;v.prev()){var h=v.value,p=h.note,g=h.pos,E=h.end;if("Slide"===p&&g===o){E||(b=!1);break}}a(t.insert(r,{lane:i,pos:o,note:"Slide",flick:!1,start:b,end:!1}))}}};var Wt=function(e){var t=e.setCode,n=Object(a.useCallback)((function(){return t("placement/single")}),[t]),i=Object(a.useCallback)((function(){return t("placement/slide-a")}),[t]),c=Object(a.useCallback)((function(){return t("placement/slide-b")}),[t]);return Yt(e,{prefix:"placement/",type:"quantize",onClick:Kt}),r.a.createElement(r.a.Fragment,null,r.a.createElement(St.a,{handleKeys:["f"],onKeyEvent:n}),r.a.createElement(St.a,{handleKeys:["s"],onKeyEvent:i}),r.a.createElement(St.a,{handleKeys:["d"],onKeyEvent:c}))};var At=function(e){var t=e.setDivision,n=Object(a.useCallback)((function(){return t(1)}),[t]),i=Object(a.useCallback)((function(){return t(2)}),[t]),c=Object(a.useCallback)((function(){return t(3)}),[t]),o=Object(a.useCallback)((function(){return t(4)}),[t]),l=Object(a.useCallback)((function(){return t(6)}),[t]),s=Object(a.useCallback)((function(){return t(8)}),[t]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(St.a,{handleKeys:["1"],onKeyEvent:n}),r.a.createElement(St.a,{handleKeys:["2"],onKeyEvent:i}),r.a.createElement(St.a,{handleKeys:["3"],onKeyEvent:c}),r.a.createElement(St.a,{handleKeys:["4"],onKeyEvent:o}),r.a.createElement(St.a,{handleKeys:["6"],onKeyEvent:l}),r.a.createElement(St.a,{handleKeys:["8"],onKeyEvent:s}))},zt=function(e,t,n,a,r,i){switch(e){case"modification/flick":var c=n(t,r,i);if(!c)break;var o=c.value,l=c.value,s=l.flick,u=l.note,m=l.end;if("Slide"===u&&!m)break;a(c.update(Object(y.a)({},o,{flick:!s})))}};var Bt=function(e){var t=e.setCode;Yt(e,{prefix:"modification/",type:"snap",onClick:zt});var n=Object(a.useCallback)((function(){return t("modification/flick")}),[t]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(St.a,{handleKeys:["w"],onKeyEvent:n}))};var Ht=function(e){var t=e.code,n=e.containerEl,i=e.setCode,c=e.inflate,o=e.quantize,l=e.timers,s=e.setTimers,u=e.currentBPM,m=Object(a.useCallback)((function(){return i("timer")}),[i]),f=Object(a.useCallback)((function(e){if("timer"===t){var n=c(e).time,a=o(n).beat,r=l.find(a);r.valid?s(r.update({bpm:u})):s(l.insert(a,{bpm:u}))}}),[t,u,c,o,s,l]);ae(n,"click",f);var d=Object(a.useCallback)((function(e){if("timer"===t){var n=c(e).time,a=o(n).beat,r=l.find(a);r.valid&&s(r.remove())}}),[t,c,o,s,l]);return ae(n,"contextmenu",d),r.a.createElement(St.a,{handleKeys:["a"],onKeyEvent:m})},Xt=Object(l.a)({dragArea:{position:"fixed",backgroundColor:"rgba(89, 150, 255, 0.4)",border:"1px solid #5996FF",visibility:"hidden"},dragLine:{position:"fixed",pointerEvents:"none",left:0,top:0,right:0,bottom:0}});var It=function(e){var t=e.code,n=e.inflate,i=e.setCode,c=e.notes,l=e.setNotes,s=e.time2Timers,u=e.matchNotePure,m=e.findNotePure,f=e.containerEl,d=e.quantize,b=e.deflate,v=Xt(),h=Object(a.useCallback)((function(){return i("select")}),[i]),p=Object(a.useCallback)((function(e,a){if("select"!==t)return!1;a.click=!0;var r=n(e),i=r.time,o=r.lane,l=u(c,s,i,o,.1);if(l){a.move=!0;var f=l.time,d=l.lane,v=l.beat,h=b({time:f,lane:d}),p=h.x,g=h.y;a.startX=p,a.startY=g,a.startIndex=m(c,v,d).index}else a.move=!1}),[t,b,m,n,u,c,s]),g=Object(a.useState)(null),E=Object(o.a)(g,2),j=E[0],O=E[1],x=Object(a.useState)(null),k=Object(o.a)(x,2),w=k[0],C=k[1],S=Object(a.useCallback)((function(e,t){var a=t.startX,r=t.startY;if(Math.sqrt(Math.pow(e.clientX-a,2)+Math.pow(e.clientY-r,2))>10&&(t.click=!1),j){j.style.visibility=t.move?"hidden":"unset";var i=Math.min(e.clientX,a),c=Math.max(e.clientX,a),o=Math.min(e.clientY,r),l=Math.max(e.clientY,r);j.style.left="".concat(i,"px"),j.style.top="".concat(o,"px"),j.style.width="".concat(c-i,"px"),j.style.height="".concat(l-o,"px")}if(w){var s=n(e),u=s.time,m=s.lane,f=d(u).time,v=Math.round(m);v<0&&(v=0),v>6&&(v=6);var h=b({time:f,lane:v}),p=h.x,g=h.y;w.style.visibility=t.move?"unset":"hidden";var E=t.shift?a:p,y=a,O=g,x=r;w.setAttribute("x1","".concat(E)),w.setAttribute("x2","".concat(y)),w.setAttribute("y1","".concat(O)),w.setAttribute("y2","".concat(x))}}),[b,j,w,n,d]),F=Object(a.useCallback)((function(e){for(var t=e.begin;t.valid;t.next()){var n=t,a=n.index,r=n.value.selected,i=void 0!==r&&r,c=n.value;i&&(e=t.update(Object(y.a)({},c,{selected:!1})),t=e.at(a))}return e}),[]),N=Object(a.useCallback)((function(e,t,n,a,r){for(var i=e.ge(t);i.valid&&i.key<n;i.next()){var c=i,o=c.index,l=c.value,s=c.value,u=s.lane,m=s.selected;u>=a&&u<r&&(e=i.update(Object(y.a)({},l,{selected:!m})),i=e.at(o))}return e}),[]),M=Object(a.useCallback)((function(e,t){var a=t.right,r=t.startX,i=t.startY,o=t.shift,f=t.click,b=t.move,v=t.startIndex,h=n(e),p=h.time,g=h.beat,E=h.lane;if(a){var O=u(c,s,p,E,.1);if(O){var x=c,k=m(x,O.beat,O.lane),C=k.index;if(!k.value.selected){var S=(x=F(x)).at(C);x=S.update(Object(y.a)({},S.value,{selected:!0}))}for(var M=nt()(),T=x.begin;T.valid;T.next()){var D=T.key,R=T.value;T.value.selected||(M=M.insert(D,R))}l(M)}}else if(f){var L=c;o||(L=F(L));var P=u(c,s,p,E,.1);if(P){var Y=P.beat,K=P.lane,W=m(L,Y,K);L=W.update(Object(y.a)({},W.value,{selected:!W.value.selected}))}l(L)}else if(b){var A=n(e),z=A.time,B=A.lane,H=d(z).beat,X=Math.round(B);X<0&&(X=0),X>6&&(X=6);var I=nt()(),q=c,$=q.at(v),U=$.key,J=$.value,V=J.selected,G=J.lane;if(!V){var Z=(q=F(q)).at(v);q=Z.update(Object(y.a)({},Z.value,{selected:!0}))}for(var _=H-U,Q=o?0:X-G,ee=function(e,t){var n=t.lane;m(I,e,n)||(I=I.insert(e,t))},te=q.begin;te.valid;te.next()){var ne=te.key,ae=te.value,re=te.value,ie=re.selected,ce=re.lane;if(ie){var oe=ne+_;if(oe<0)continue;var le=ce+Q;le<0&&(le=0),le>6&&(le=6),ee(oe,Object(y.a)({},ae,{lane:le}))}else ee(ne,ae)}l(I)}else{var se=c;o||(se=F(se));var ue=n({clientX:r,clientY:i}),me=ue.beat,fe=ue.lane,de=g,be=E,ve=Math.min(me,de),he=Math.max(me,de),pe=Math.min(fe,be),ge=Math.max(fe,be);se=N(se,ve,he,pe,ge),l(se)}j&&(j.style.visibility="hidden"),w&&(w.style.visibility="hidden")}),[F,j,w,m,n,u,c,d,l,s,N]);return Et({onDragStart:p,onDrag:S,onDragEnd:M,el:f}),r.a.createElement(r.a.Fragment,null,r.a.createElement(St.a,{handleKeys:["v"],onKeyEvent:h}),r.a.createElement("div",{className:v.dragArea,ref:O}),r.a.createElement("div",{className:v.dragLine},r.a.createElement("svg",{width:"100%",height:"100%"},r.a.createElement("line",{stroke:"#5996FF",strokeWidth:"2",x1:"100",x2:"200",y1:"100",y2:"200",ref:C,style:{visibility:"hidden"}}))))};var qt=function(e){var t=e.music.duration,n=e.scaleRef,r=e.scaleSpeed,i=e.minScale,c=e.maxScale,o=e.scrollSpeed,l=e.scrollRef,s=e.containerEl,u=Object(a.useCallback)((function(e){var a=jt(e).pixelY,s=n.current;if(e.ctrlKey){var u=s*t,m=(e.clientY+l.current)/u,f=s*(1-a*r);f<i&&(f=i),f>c&&(f=c);var d=f*t,b=m*d-e.clientY;b<0&&(b=0),b+window.innerHeight>d&&(b=d-window.innerHeight),l.current=b,n.current=f}else{var v=s*t,h=l.current+a*o*Math.sqrt(s);h<0&&(h=0),h+window.innerHeight>v&&(h=v-window.innerHeight),l.current=h}}),[n,t,l,r,i,c,o]);return Object(a.useEffect)((function(){var e=function(e){if(e.ctrlKey)return e.stopPropagation(),e.preventDefault(),!1};return window.addEventListener("wheel",e,{passive:!1}),function(){return window.removeEventListener("wheel",e)}}),[]),ae(s,"wheel",u),Object(a.useEffect)((function(){var e=t*n.current;l.current=e-window.innerHeight}),[t,n,l]),null},$t=Object(l.a)({middle:{position:"absolute",left:"25%",top:0,height:"100%",display:"flex",flexDirection:"row",justifyContent:"start",alignItems:"stretch"},right:{position:"absolute",right:0,height:"100%",top:0}});var Ut=function(e){var t=e.music,n=e.score,a=$t(),i=it({music:t,score:n}),c=et(i),o=Qe(),l=Object(y.a)({music:t},i,{},c,{},o);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:a.middle},r.a.createElement(lt,l),r.a.createElement(qt,l),r.a.createElement(Pt,l),r.a.createElement(Ht,l),r.a.createElement(Bt,l),r.a.createElement(Wt,l),r.a.createElement(It,l),r.a.createElement(At,l),r.a.createElement(Ft,l),r.a.createElement(Lt,l),r.a.createElement(_e,l)),r.a.createElement("div",{className:a.right},r.a.createElement(Ot,l,r.a.createElement(ut,Object.assign({},l,{division:.25,thumb:!0})),r.a.createElement(wt,l),r.a.createElement(gt,Object.assign({},l,{thumb:!0})))))},Jt=Object(l.a)({middle:{position:"absolute",left:"25%",top:0,height:"100%",display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",width:470,fontSize:28,fontWeight:"bold",backgroundColor:"#000",color:"#FFF"},right:{position:"absolute",right:0,height:"100%",top:0,width:"11em",fontSize:"".concat(78/11,"px"),backgroundColor:"#000"}});var Vt=function(e){var t=e.children,n=Jt();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:n.middle},t),r.a.createElement("div",{className:n.right}))},Gt=Object(l.a)({root:{width:"100%",height:"100%"},left:{position:"absolute",left:0,top:0},middle:{position:"absolute",left:"25%",top:0,height:"100%"}});var Zt=function(){var e=Gt(),t=Object(a.useMemo)((function(){return function(){var e=localStorage.getItem("score");return null===e?O:JSON.parse(e)}()}),[]),n=Object(a.useState)(t),i=Object(o.a)(n,2),c=i[0],l=i[1],s=Object(a.useState)(localStorage.getItem("music")),u=Object(o.a)(s,2),m=u[0],f=u[1];Object(a.useEffect)((function(){m&&localStorage.setItem("music",m)}),[m]);var d=Object(a.useMemo)((function(){return new Audio}),[]);Object(a.useEffect)((function(){d.src=m,d.load()}),[d,m]);var b=Object(a.useState)(!1),v=Object(o.a)(b,2),h=v[0],p=v[1],g=Object(a.useCallback)((function(){return p(d.duration>0)}),[d]);ae(d,"durationchange",g);var E=Object(a.useCallback)((function(){return p(!1)}),[]);ae(d,"emptied",E);var j={score:c,setScore:l,musicURL:m,setMusicURL:f,music:d,musicLoaded:h};return r.a.createElement("div",{className:e.root},r.a.createElement("div",{className:e.left},r.a.createElement(ne,j)),h?r.a.createElement(Ut,j):r.a.createElement(Vt,null,null===m?"\u8bf7\u5148\u9009\u62e9\u6b4c\u66f2":"\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019"))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(Zt,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}]),[[55,1,2]]]);
//# sourceMappingURL=main.ce72b09c.chunk.js.map